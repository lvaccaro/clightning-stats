<html>

<style>
    #title {
        font-family: "Lucida Console", Monaco, monospace;
        font-size: 10px;
        margin: auto;
        width: auto;
    }
    .logo {
        font-family: "Lucida Console", Monaco, monospace;
        font-size: 1px;
        float: left;
        padding: 10px;
        margin: auto;
        width: auto;
    }
</style>
<body>


<div style="display:flex">
<pre class="logo">
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN0XMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWWMMMMMMMMMMMMMMMMMMMNx:oXMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNX0kxollcc::::::cclldxkKNMMMMMMNx, ,0MMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXOdc;'..                   .dXMMMMNx,  .xWMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMWKxl,.                        .c0WMMMXx,    lNMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMN0o;.                ...........c0WMMMXx,     ;KMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMWKd;.           .':loxk00KXXXXXKK0XWMMMXx,      .kWMMW0kKWMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMWOc.          ':dOKNWMMMMMMMMMMMMMMMMMMXx,        oNMMMK, .l0WMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMNO:.        .;oONWMMMMMMMMMMMMMMMMMMMMMXx,         ;XMMMNc    .c0WMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMW0:.        ,o0WMMMMMMMMMMMMMMMMMMMMMMMXd,          'OMMMWx.      .cKWMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMXo.       .:kNMMMMMMMMMMMMMMMMMMMMMMMMXd'           .dWMMMWO:.       .dNMMMMMMMMMMMMMM
MMMMMMMMMMMMW0;       .:OWMMMMMMMMMMMMMMMMMMMMMMMX0d'             cXMMMMMMNO;.       :0WMMMMMMMMMMMM
MMMMMMMMMMMWx.       ,kNMMMMMMMMMMMMMMMMMMMMMMMXd'.              '0MMMMMMMMMNx'       'kWMMMMMMMMMMM
MMMMMMMMMMNd.      .oXMMMMMMMMMMMMMMMMMMMMMMMXd'                .xWMMMMMMMMMMMKl.      .xWMMMMMMMMMM
MMMMMMMMMNd.      .kWMMMMMMMMMMMMMMMMMMMMMMXd'                  lNMMMMMMMMMMMMMNx.      .xWMMMMMMMMM
MMMMMMMMWx.      'OWMMMMMMMMMMMMMMMMMMMMMXd'                   ;KMMMMMMMMMMMMMMMWk'      .kWMMMMMMMM
MMMMMMMMO'      'OWMMMMMMMMMMMMMMMMMMMWXd'                    .kWMMMMMMMMMMMMMMMMWk.      ,0MMMMMMMM
MMMMMMMX:      .xWMMMMMMMMMMMMMMMMMMMXd'                      oNMMMMMMMMMMMMMMMMMMWx.      lNMMMMMMM
MMMMMMWx.      lNMMMMMMMMMMMMMMMMMMXd'                       ;KMMMMMMMMMMMMMMMMMMMMNc      .kMMMMMMM
MMMMMMX:      '0MMMMMMMMMMMMMMMMWXd'                        'OMMMMMMMMMMMMMMMMMMMMMMO'      lNMMMMMM
MMMMMMO'      lNMMMMMMMMMMMMMMWXo'                          .coolooooooooooooodOWMMMNl      ,KMMMMMM
MMMMMWx.     .xMMMMMMMMMMMMMWKo'                                             'oKWMMMWx.     .OMMMMMM
MMMMMWo      'OMMMMMMMMMMMWKo.                                             'dXMMMMMMMO.     .xMMMMMM
MMMMMWl      '0MMMMMMMMMWKo.                                             'dXMMMMMMMMM0'     .xWMMMMM
MMMMMWl      '0MMMMMMMWKo.                                             ,dXMMMMMMMMMMM0'     .xWMMMMM
MMMMMWd.     .OMMMMMWKo.                                             ,xXMMMMMMMMMMMMMk.     .kMMMMMM
MMMMMMk.     .dWMMMWO:.................                            ,xNMMMMMMMMMMMMMMWd.     '0MMMMMM
MMMMMMK,      :XMMMWNXXXXXXXXXXXXXXXXXk,                         ;kNMMMMMMMMMMMMMMMMX:      cNMMMMMM
MMMMMMWo      .xWMMMMMMMMMMMMMMMMMMMMNl                       .;kNMMMMMMMMMMMMMMMMMWx.     .xWMMMMMM
MMMMMMM0'      ;KMMMMMMMMMMMMMMMMMMMWx.                     .;kNMMMMMMMMMMMMMMMMMMMK,      :XMMMMMMM
MMMMMMMWd.      cXMMMMMMMMMMMMMMMMMMO'                    .:ONMMMMMMMMMMMMMMMMMMMMXc      .kMMMMMMMM
MMMMMMMMXc      .lNMMMMMMMMMMMMMMMMK;                   .:OWMMMMMMMMMMMMMMMMMMMMMNl      .oNMMMMMMMM
MMMMMMMMMK;      .lXMMMMMMMMMMMMMMNl                  .cOWMMMMMMMMMMMMMMMMMMMMMMXc       cXMMMMMMMMM
MMMMMMMMMM0;       :0WMMMMMMMMMMMWd.                .c0WMMMMMMMMMMMMMMMMMMMMMMW0:       cXMMMMMMMMMM
MMMMMMMMMMMK:       .xNMMMMMMMMMMO.              .,l0WMMMMMMMMMMMMMMMMMMMMMMMNx.      .lXMMMMMMMMMMM
MMMMMMMMMMMMXl.       :OWMMMMMMMK;             .l0NWMMMMMMMMMMMMMMMMMMMMMMMWO;       .dNMMMMMMMMMMMM
MMMMMMMMMMMMMNx'       .cOWMMMMNc            .lKWMMMMMMMMMMMMMMMMMMMMMMMMNO:.       ,OWMMMMMMMMMMMMM
MMMMMMMMMMMMMMWKl.       ,KMMMWd.          .oKWMMMMMMMMMMMMMMMMMMMMMMMWXx;.       .oXMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMWO:.    .dWMMWO.         'oKWMMMMMMMMMMMMMMMMMMMMMMWXkc.        .c0WMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMWOc.  cNMMMK;        'dXMMMMMMMMMMMMMMMMMMMMMWXOd:.         .l0WMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMW0ooKMMMXc       'dXMMMMMMMMMMMMMMMMWWXKOdl;.           ,oKWMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMWMMMWd.     ,xXMMMWKoccllllllllc:;,..             'lONMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMWk.    ,xXMMMWKl.                          .;oONWMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMM0,   ,xNMMMW0l.                       .':okKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMXc  ;kNMMMMMNx:,...           ...',:ldkKNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMNd.;kNMMMMMMMMMWWXXK0OkkkkkkkOO0KXNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMKdONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM

</pre>
</div>
<div style="display:flex">
<pre id="title">
 __       __    _______  __    __  .___________..__   __.  __  .__   __.   _______
|  |     |  |  /  _____||  |  |  | |           ||  \ |  | |  | |  \ |  |  /  _____|
|  |     |  | |  |  __  |  |__|  | `---|  |----`|   \|  | |  | |   \|  | |  |  __
|  |     |  | |  | |_ | |   __   |     |  |     |  . `  | |  | |  . `  | |  | |_ |
|  `----.|  | |  |__| | |  |  |  |     |  |     |  |\   | |  | |  |\   | |  |__| |
|_______||__|  \______| |__|  |__|     |__|     |__| \__| |__| |__| \__|  \______|
</pre>
</div>

<pre><h4>Stats server endpoint:</h4></pre>
<pre id="url">
</pre>

<pre><h4>Info node:</h4></pre>
<pre id="info">
</pre>

<pre><h4>Direct channels:</h4></pre>
<pre id="channels">
</pre>

<pre><h4>List peers:</h4></pre>
<pre id="peers">
</pre>

<pre><h4>Github repository:</h4></pre>
<pre>
 <a href="https://github.com/lvaccaro/clightning-stats">https://github.com/lvaccaro/clightning-stats</a>
</pre>

<script>

    // Configs
    var url = "http://btctest.waldo.fun:4000"; // your server url
    var alias = "Waldo.fun"; // your node name

    // Init calls
    printUrl(url);
    getinfo();

    // Functions
        function getinfo() {
            var xhttp = new XMLHttpRequest();
            xhttp.open("GET", url+"/getinfo", true);
            xhttp.onreadystatechange = function () {
                if (this.readyState === this.DONE) {
                    //console.log(xhttp.responseText);
                    info = JSON.parse(xhttp.responseText);
                    info.alias = alias;
                    printInfo(info);
                    listpeers();
                }
            }
            xhttp.onerror = function (e) {
                console.error(xhr.statusText);
            };
            xhttp.send();
        }

        function listpeers() {
            var xhttp = new XMLHttpRequest();
            xhttp.open("GET", url+"/listpeers", true);
            xhttp.onreadystatechange = function () {
                if (this.readyState === this.DONE) {

                    //console.log(xhttp.responseText);
                    peers = JSON.parse(xhttp.responseText).peers;
                    //printPeers(peers);

                    var channels = [];
                    peers.forEach(function (p) {
                        if (p.channels) {
                            p.channels.forEach(function (c) {
                                c.id = p.id;
                                channels.push(c);
                            });
                        }
                    });
                    //printChannels(channels);

                    listnodes(function (nodes) {
                        nodes.forEach(function (n) {
                            channels.forEach(function (c) {
                                if (n.nodeid == c.id) {
                                    c.alias = n.alias;
                                }
                            });
                            peers.forEach(function (p) {
                                if (n.nodeid == p.id) {
                                    p.alias = n.alias;
                                }
                            });
                        });

                        printPeers(peers);
                        printChannels(channels);
                    });
                }
            }
            xhttp.onerror = function (e) {
                console.error(xhr.statusText);
            };
            xhttp.send();
        }


        function listnodes(callback) {
            var xhttp = new XMLHttpRequest();
            xhttp.open("GET", url+"/listnodes", true);
            xhttp.onreadystatechange = function () {
                if (this.readyState === this.DONE) {

                    //console.log(xhttp.responseText);
                    nodes = JSON.parse(xhttp.responseText).nodes;
                    callback(nodes);
                }
            }
            xhttp.onerror = function (e) {
                console.error(xhr.statusText);
            };
            xhttp.send();
        }


        function printUrl(url) {
            var tag = document.getElementById("url");
            tag.innerHTML = url;
        }

        function printInfo(info) {
            var tag = document.getElementById("info");
            tag.innerHTML = "";
            var address;
            if (info.address && info.address.length > 0 && info.address[0].address)
                address = info.address[0].address;

            tag.innerHTML = "\tnodeid: " + info.id + "\n" +
                "\taddress: " + ((address) ? address : '') + "\n" +
                "\tport: " + info.port + "\n" +
                "\talias: " + info.alias + "\n" +
                "\tversion: " + info.version + "\n" +
                "\tblockheight: " + info.blockheight + "\n" +
                "\tnetwork: " + info.network + "\n";
        }


        function printPeers(peers) {
            var tag = document.getElementById("peers");
            tag.innerHTML = "";
            peers.forEach(function (p) {
                tag.innerHTML += "\tnodeid: " + p.id + "\n" +
                    ((p.alias) ? ("\talias: " + p.alias + "\n") : "") +
                    "\tconnected: " + p.connected + "\n" +
                    "\tstate: " + ((p.state) ? p.state : "NORMAL") + "\n" +
                    "\tchannels: " + ((p.channels) ? p.channels.length : 0) + "\n\n";
            });
        }


        function printChannels(channels) {
            var tag = document.getElementById("channels");
            tag.innerHTML = "";

            var count = 0, capacityTotal = 0, capacityUs = 0;
            channels.forEach(function (c) {
                if (c.state == "CHANNELD_NORMAL") {
                    count++;
                    capacityUs += c.msatoshi_to_us;
                    capacityTotal += c.msatoshi_total;

                }
            });
            tag.innerHTML += "Num channels : " + count + "\n";
            tag.innerHTML += "Your channel-side capacity : " + capacityUs + " msatoshi\n";
            tag.innerHTML += "Total capacity in channels : " + capacityTotal + " msatoshi\n\n";

            channels.forEach(function (c) {
                tag.innerHTML +=
                    "\tchannelid: " + ((c.short_channel_id) ? c.short_channel_id : '') + "\n" +
                    "\tnodeid: " + c.id + "\n" +
                    ((c.alias) ? ("\talias: " + c.alias + "\n") : "") +
                    "\tfunding_txid: " + c.funding_txid + "\n" +
                    "\tstate: " + c.state + "\n" +
                    "\tmsatoshi: " + c.msatoshi_to_us + "/" + c.msatoshi_total + "\n" +
                    "\tto_self_delay: " + c.to_self_delay + "\n\n";
            });
        }

</script>


</body>
</html>